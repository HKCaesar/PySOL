
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gsdview.pluginmanager &mdash; GSDView Open Edition Home Page</title>
    <link rel="stylesheet" href="../../_static/sourceforge.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/logo.ico"/>
    <link rel="top" title="GSDView Open Edition Home Page" href="../../index.html" />
    <link rel="up" title="gsdview" href="../gsdview.html" /> 
  </head>
  <body>
    
        
    
    
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li><a href="../../index.html">GSDView</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../gsdview.html" accesskey="U">gsdview</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for gsdview.pluginmanager</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c">### Copyright (C) 2008-2011 Antonio Valentino &lt;a_valentino@users.sf.net&gt;</span>

<span class="c">### This file is part of GSDView.</span>

<span class="c">### GSDView is free software; you can redistribute it and/or modify</span>
<span class="c">### it under the terms of the GNU General Public License as published by</span>
<span class="c">### the Free Software Foundation; either version 2 of the License, or</span>
<span class="c">### (at your option) any later version.</span>

<span class="c">### GSDView is distributed in the hope that it will be useful,</span>
<span class="c">### but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">### MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">### GNU General Public License for more details.</span>

<span class="c">### You should have received a copy of the GNU General Public License</span>
<span class="c">### along with GSDView; if not, write to the Free Software</span>
<span class="c">### Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA.</span>


<span class="sd">&#39;&#39;&#39;Plugin manager.&#39;&#39;&#39;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pkgutil</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">distutils.versionpredicate</span> <span class="kn">import</span> <span class="n">VersionPredicate</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pkg_resources</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;&quot;pkg_resources&quot; not found.&#39;</span><span class="p">)</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Antonio Valentino &lt;a_valentino@users.sf.net&gt;&#39;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s">&#39;$Date: 2009-05-31 10:28:43 +0200 (dom, 31 mag 2009) $&#39;</span>
<span class="n">__revision__</span> <span class="o">=</span> <span class="s">&#39;$Revision: 430 $&#39;</span>


<div class="viewcode-block" id="PluginManager"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager">[docs]</a><span class="k">class</span> <span class="nc">PluginManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">syspath</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PluginManager</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span> <span class="o">=</span> <span class="n">syspath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoload</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app</span> <span class="o">=</span> <span class="n">app</span>

    <span class="k">def</span> <span class="nf">_get_allplugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">plugins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">plugins</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanpaths</span><span class="p">())</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">plugins</span><span class="p">)</span>

    <span class="n">allplugins</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_allplugins</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&#39;List of all availabe plugins.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_scanpaths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">plugins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">loader</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ispkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">egg</span> <span class="ow">in</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">find_distributions</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">egg</span><span class="o">.</span><span class="n">egg_name</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">plugins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">egg</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">plugins</span>

    <span class="k">def</span> <span class="nf">_check_dependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depstring</span><span class="p">):</span>
        <span class="c"># @TODO: use pkg_resources&#39; parse_requirements and Requirement</span>
        <span class="c">#        if available:</span>
        <span class="c">#           for r in parse_requirements(&#39;gsdview &gt;= 0.5&#39;):</span>
        <span class="c">#               return r.key in self.plugins and avail_ver in r</span>

        <span class="n">depstring</span> <span class="o">=</span> <span class="n">depstring</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">depstring</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="n">modules</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>

        <span class="c"># @TODO: use a cleaner way to provide extra modules for check</span>
        <span class="c">#import gsdview</span>
        <span class="c">#modules[&#39;gsdview&#39;] = gsdview</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">vp</span> <span class="o">=</span> <span class="n">VersionPredicate</span><span class="p">(</span><span class="n">depstring</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="c"># @TODO: remove dependency from self._app</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;invalid version preficate &quot;</span><span class="si">%s</span><span class="s">&quot;: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                                                <span class="n">depstring</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">vp</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">vp</span><span class="o">.</span><span class="n">satisfied_by</span><span class="p">(</span><span class="n">modules</span><span class="p">[</span><span class="n">vp</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>  <span class="c"># , exc_info=True)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_check_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">depstring</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">__requires__</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dependency</span><span class="p">(</span><span class="n">depstring</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;gsdview&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;error checking dependencies for module: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">module</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="PluginManager.load_module"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager.load_module">[docs]</a>    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># @TODO: make the module independent from gsdview</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;gsdview&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">__name__</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># @TODO: find a more general form to pass arguments to plugins</span>
            <span class="n">module</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot; plugin loaded.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>   <span class="c"># AttributeError:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;error loading &quot;</span><span class="si">%s</span><span class="s">&quot; plugin: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

    <span class="c"># @WARNING: (pychecker) Parameter (type_) not used</span></div>
<div class="viewcode-block" id="PluginManager.load"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">info_only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s">&#39;plugins&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syspath</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>

        <span class="c"># @TODO: make the module independent from gsdview</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;gsdview&#39;</span><span class="p">)</span>
        <span class="n">delayed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">importer</span> <span class="o">=</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">get_importer</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">distributions</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">find_distributions</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">distributions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">egg</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">egg</span><span class="p">)</span> <span class="k">for</span> <span class="n">egg</span> <span class="ow">in</span> <span class="n">distributions</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="n">distributions</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">loader</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">loader</span><span class="p">:</span>
                            <span class="n">module</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">distributions</span><span class="p">:</span>
                            <span class="n">egg</span> <span class="o">=</span> <span class="n">distributions</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                            <span class="n">egg</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
                            <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;unable to find &quot;</span><span class="si">%s</span><span class="s">&quot; plugin&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
                            <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;unable to import &quot;</span><span class="si">%s</span><span class="s">&quot; plugin: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                                                                    <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                        <span class="k">continue</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">info_only</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_deps</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
                        <span class="n">delayed</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;loading of &quot;</span><span class="si">%s</span><span class="s">&quot; plugin delayed&#39;</span> <span class="o">%</span>
                                                                <span class="n">module</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c"># @TODO: delayed loading</span>
        <span class="k">if</span> <span class="n">delayed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">info_only</span><span class="p">:</span>
            <span class="n">MAXATTEMPTS</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">delayed_again</span> <span class="o">=</span> <span class="n">delayed</span>
            <span class="n">iter_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">loaded_count</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">while</span> <span class="n">delayed_again</span> <span class="ow">and</span> <span class="n">loaded_count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># check for max number of iterations</span>
                <span class="k">if</span> <span class="n">iter_count</span> <span class="o">&gt;</span> <span class="n">MAXATTEMPTS</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;max number of attempts reached for &#39;</span>
                                   <span class="s">&#39;delayed plugins loading&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">loaded_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">delayed</span> <span class="o">=</span> <span class="n">delayed_again</span>
                <span class="n">delayed_again</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">delayed</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_deps</span><span class="p">(</span><span class="n">module</span><span class="p">):</span>
                        <span class="n">delayed_again</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;loading of &quot;</span><span class="si">%s</span><span class="s">&quot; plugin delayed &#39;</span>
                                      <span class="s">&#39;again&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                        <span class="n">loaded_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delayed_again</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> modules not loaded because of unmet &#39;</span>
                            <span class="s">&#39;dependency&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">delayed_again</span><span class="p">))</span>

                <span class="c"># @TODO: log more verbose info: per module dependency failure</span>

    <span class="c"># @WARNING: (pychecker) Parameter (type_) not used</span></div>
<div class="viewcode-block" id="PluginManager.unload"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager.unload">[docs]</a>    <span class="k">def</span> <span class="nf">unload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s">&#39;plugin&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c"># @TODO: find a more general form to pass arguments to plugins</span>
            <span class="n">module</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PluginManager.reset"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="c"># @TODO: find a more general form to pass arguments to plugins</span>
            <span class="n">plugin</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># @NOTE: this method is Qt specific</span>
    <span class="c"># @TODO: move to specialized classes implementations that rely on a</span>
    <span class="c">#        specific external library</span></div>
<div class="viewcode-block" id="PluginManager.save_settings"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager.save_settings">[docs]</a>    <span class="k">def</span> <span class="nf">save_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">beginGroup</span><span class="p">(</span><span class="s">&#39;pluginmanager&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span>    <span class="c"># @NOTE: copy</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syspath</span><span class="p">)</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&#39;pluginspaths&#39;</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>

            <span class="n">autoload</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoload</span><span class="p">)</span>
            <span class="n">autoload</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">autoload</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allplugins</span><span class="p">))</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&#39;autoload_plugins&#39;</span><span class="p">,</span> <span class="n">autoload</span><span class="p">)</span>

            <span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&#39;available_plugins&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allplugins</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">endGroup</span><span class="p">()</span>

    <span class="c"># @NOTE: this method is Qt specific</span>
    <span class="c"># @TODO: move to specialized classes implementations that rely on a</span>
    <span class="c">#        specific external library</span></div>
<div class="viewcode-block" id="PluginManager.load_settings"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManager.load_settings">[docs]</a>    <span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">settings</span><span class="o">.</span><span class="n">beginGroup</span><span class="p">(</span><span class="s">&#39;pluginmanager&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s">&#39;pluginspaths&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">syspath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syspath</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">autoload</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s">&#39;autoload_plugins&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoload</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">autoload</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoload</span><span class="p">)</span>

            <span class="c"># @TODO: check</span>
            <span class="c"># @NOTE: by default loads new plugins</span>
            <span class="n">available_plugins</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allplugins</span><span class="p">)</span>

            <span class="n">old_plugins</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s">&#39;available_plugins&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">new_plugins</span> <span class="o">=</span> <span class="n">available_plugins</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">old_plugins</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">new_plugins</span><span class="p">))</span>
            <span class="c"># only marks actually loaded plugins</span>
            <span class="n">new_plugins</span><span class="o">.</span><span class="n">intersection_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoload</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_plugins</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">endGroup</span><span class="p">()</span>


<span class="c">### GUI #######################################################################</span>

<span class="c"># @TODO: move Qt specific implementation elsewhere</span></div></div>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="kn">from</span> <span class="nn">qt</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>

<span class="c"># @TODO: check dependency - getuiform, geticon, setViewContextActions</span>
<span class="kn">import</span> <span class="nn">qt4support</span>


<span class="n">PluginManagerGuiBase</span> <span class="o">=</span> <span class="n">qt4support</span><span class="o">.</span><span class="n">getuiform</span><span class="p">(</span><span class="s">&#39;pluginmanager&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="PluginManagerGui"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui">[docs]</a><span class="k">class</span> <span class="nc">PluginManagerGui</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">PluginManagerGuiBase</span><span class="p">):</span>

    <span class="c"># @TODO: emit signal for ???</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pluginmanager</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">flags</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PluginManagerGui</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Set icons</span>
        <span class="n">geticon</span> <span class="o">=</span> <span class="n">qt4support</span><span class="o">.</span><span class="n">geticon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">geticon</span><span class="p">(</span><span class="s">&#39;add.svg&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">geticon</span><span class="p">(</span><span class="s">&#39;remove.svg&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">geticon</span><span class="p">(</span><span class="s">&#39;edit.svg&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">geticon</span><span class="p">(</span><span class="s">&#39;go-up.svg&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">geticon</span><span class="p">(</span><span class="s">&#39;go-down.svg&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">))</span>

        <span class="c"># Set plugin manager attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span> <span class="o">=</span> <span class="n">pluginmanager</span>

        <span class="c"># Context menu</span>
        <span class="n">qt4support</span><span class="o">.</span><span class="n">setViewContextActions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="p">)</span>
        <span class="n">qt4support</span><span class="o">.</span><span class="n">setViewContextActions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pluginsTableWidget</span><span class="p">)</span>

        <span class="c"># @TODO: check edit triggers</span>
        <span class="c">#int(self.pathListWidget.editTriggers() &amp;</span>
        <span class="c">#                                   self.pathListWidget.DoubleClicked)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">pathSelectionChanged</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addPathItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removeSelectedPathItem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveSelectedPathItemsUp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moveSelectedPathItemsDown</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editSelectedPathItem</span><span class="p">)</span>

    <span class="nd">@QtCore.Slot</span><span class="p">()</span>
<div class="viewcode-block" id="PluginManagerGui.pathSelectionChanged"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.pathSelectionChanged">[docs]</a>    <span class="k">def</span> <span class="nf">pathSelectionChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enabled</span><span class="p">)</span>
</div>
    <span class="nd">@QtCore.Slot</span><span class="p">()</span>
<div class="viewcode-block" id="PluginManagerGui.addPathItem"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.addPathItem">[docs]</a>    <span class="k">def</span> <span class="nf">addPathItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># @TODO: don&#39;t directly use _app attribute</span>
        <span class="n">filedialog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">filedialog</span>
        <span class="n">filedialog</span><span class="o">.</span><span class="n">setFileMode</span><span class="p">(</span><span class="n">filedialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">filedialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()):</span>
            <span class="n">dirs</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()</span>
            <span class="n">existingdirs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
            <span class="k">for</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dir_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existingdirs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
</div>
    <span class="nd">@QtCore.Slot</span><span class="p">()</span>
<div class="viewcode-block" id="PluginManagerGui.removeSelectedPathItem"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.removeSelectedPathItem">[docs]</a>    <span class="k">def</span> <span class="nf">removeSelectedPathItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">model</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</div>
    <span class="nd">@QtCore.Slot</span><span class="p">()</span>
<div class="viewcode-block" id="PluginManagerGui.editSelectedPathItem"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.editSelectedPathItem">[docs]</a>    <span class="k">def</span> <span class="nf">editSelectedPathItem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c"># @TODO: don&#39;t directly use _app attribute</span>
            <span class="n">filedialog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">filedialog</span>
            <span class="n">filedialog</span><span class="o">.</span><span class="n">setFileMode</span><span class="p">(</span><span class="n">filedialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">)</span>
            <span class="n">filedialog</span><span class="o">.</span><span class="n">selectFile</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span><span class="p">(</span><span class="n">filedialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()):</span>
                <span class="n">dirs</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">dirs</span><span class="p">:</span>
                    <span class="n">dir_</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">dir_</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_movePathItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">listwidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">listwidget</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="n">row</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">listwidget</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">listwidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">row</span>

        <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">selected</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">isSelected</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">listwidget</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">listwidget</span><span class="o">.</span><span class="n">insertItem</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>

    <span class="nd">@QtCore.Slot</span><span class="p">()</span>
<div class="viewcode-block" id="PluginManagerGui.moveSelectedPathItemsUp"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.moveSelectedPathItemsUp">[docs]</a>    <span class="k">def</span> <span class="nf">moveSelectedPathItemsUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">(),</span>
                          <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">row</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">selected</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_movePathItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@QtCore.Slot</span><span class="p">()</span>
<div class="viewcode-block" id="PluginManagerGui.moveSelectedPathItemsDown"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.moveSelectedPathItemsDown">[docs]</a>    <span class="k">def</span> <span class="nf">moveSelectedPathItemsDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">(),</span>
                          <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">selected</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_movePathItem</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PluginManagerGui.update_view"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.update_view">[docs]</a>    <span class="k">def</span> <span class="nf">update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">allplugins</span><span class="p">,</span> <span class="n">info_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">tablewidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginsTableWidget</span>
        <span class="n">tablewidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">tablewidget</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">tablewidget</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Name&#39;</span><span class="p">),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Description&#39;</span><span class="p">),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Info&#39;</span><span class="p">),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Active&#39;</span><span class="p">),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Load on startup&#39;</span><span class="p">)])</span>

        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">allplugins</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">plugin</span>
            <span class="n">short_description</span> <span class="o">=</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;NOT AVAILABLE&#39;</span><span class="p">)</span>
            <span class="n">disabled</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">plugins</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">dict_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">short_description</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">short_description</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s">&quot;&#39;name&#39;&quot;</span> <span class="ow">in</span> <span class="n">msg</span>
                                    <span class="ow">and</span> <span class="ow">not</span>  <span class="s">&quot;&#39;short_description&#39;&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">):</span>
                        <span class="k">raise</span>
                    <span class="n">disabled</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">disabled</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="n">index</span> <span class="o">=</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="n">tablewidget</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

            <span class="c"># name/description</span>
            <span class="n">tablewidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">tablewidget</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">QtGui</span><span class="o">.</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">short_description</span><span class="p">))</span>

            <span class="c"># info</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">qt4support</span><span class="o">.</span><span class="n">geticon</span><span class="p">(</span><span class="s">&#39;info.svg&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">tablewidget</span><span class="p">,</span>
                                  <span class="n">toolTip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Show plugin info.&#39;</span><span class="p">),</span>
                                  <span class="n">clicked</span><span class="o">=</span><span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">showPluginInfo</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
                                  <span class="c">#clicked=lambda index=index:</span>
                                  <span class="c">#              self.showPluginInfo(index))</span>
            <span class="n">tablewidget</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

            <span class="c"># active</span>
            <span class="n">checked</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="n">tablewidget</span><span class="p">,</span> <span class="n">checked</span><span class="o">=</span><span class="n">checked</span><span class="p">)</span>
            <span class="n">tablewidget</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

            <span class="c"># TODO: remove this block when plugins unloading will be</span>
            <span class="c">#       available</span>
            <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

            <span class="c"># autoload</span>
            <span class="n">checked</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">plugin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">autoload</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="n">tablewidget</span><span class="p">,</span> <span class="n">checked</span><span class="o">=</span><span class="n">checked</span><span class="p">,</span>
                                <span class="n">toolTip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&#39;Load on startup&#39;</span><span class="p">))</span>
            <span class="n">tablewidget</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">disabled</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tablewidget</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">^</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s">&quot;Plugin don&#39;t seems to be &quot;</span>
                                             <span class="s">&quot;compatible with GSDView.&quot;</span><span class="p">)</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">w</span> <span class="o">=</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">tablewidget</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PluginManagerGui.load"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_view</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PluginManagerGui.update_pluginmanager"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.update_pluginmanager">[docs]</a>    <span class="k">def</span> <span class="nf">update_pluginmanager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>

        <span class="n">tablewidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginsTableWidget</span>

        <span class="n">active</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">autoload</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tablewidget</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tablewidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">active</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">tablewidget</span><span class="o">.</span><span class="n">cellWidget</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">autoload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="n">toload</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span>
        <span class="n">tounload</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">plugins</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">toload</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">tounload</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">toload</span><span class="p">)</span>
        <span class="c"># TODO: do not allow backends unloading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="n">tounload</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">autoload</span> <span class="o">=</span> <span class="n">autoload</span>
</div>
<div class="viewcode-block" id="PluginManagerGui.save"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_pluginmanager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">save_settings</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PluginManagerGui.showPluginInfo"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginManagerGui.showPluginInfo">[docs]</a>    <span class="k">def</span> <span class="nf">showPluginInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginsTableWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pluginmanager</span><span class="o">.</span><span class="n">plugins</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">plugin</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">PluginInfoDialog</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">active</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

</div></div>
<span class="n">PluginInfoFormBase</span> <span class="o">=</span> <span class="n">qt4support</span><span class="o">.</span><span class="n">getuiform</span><span class="p">(</span><span class="s">&#39;plugininfo&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="PluginInfoForm"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginInfoForm">[docs]</a><span class="k">class</span> <span class="nc">PluginInfoForm</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QFrame</span><span class="p">,</span> <span class="n">PluginInfoFormBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">flags</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PluginInfoForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plugin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadinfo</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">active</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<div class="viewcode-block" id="PluginInfoForm.loadinfo"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginInfoForm.loadinfo">[docs]</a>    <span class="k">def</span> <span class="nf">loadinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">active</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nameValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">authorValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emailValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s">&#39;&amp;lt;&lt;a href=&quot;mailto:</span><span class="si">%(email)s</span><span class="s">&quot;&gt;</span><span class="si">%(email)s</span><span class="s">&lt;/a&gt;&amp;gt;&#39;</span> <span class="o">%</span>
                                            <span class="nb">dict</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">plugin</span><span class="o">.</span><span class="n">author_email</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revisionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">__revision__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">licenseValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">license_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyrightValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">copyright</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">websiteValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span>
                                        <span class="p">(</span><span class="n">plugin</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">plugin</span><span class="o">.</span><span class="n">website_label</span><span class="p">))</span>

        <span class="n">fullpath</span> <span class="o">=</span> <span class="n">plugin</span><span class="o">.</span><span class="n">__file__</span>
        <span class="k">if</span> <span class="n">fullpath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pyc&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fullpath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.pyo&#39;</span><span class="p">):</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">fullpath</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;co&#39;</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">__init__.py&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
        <span class="k">if</span> <span class="n">fullpath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">fullpath</span><span class="p">[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fullPathValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">fullpath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadedCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PluginInfoForm.clear"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginInfoForm.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nameValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descriptionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">authorValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emailValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">versionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revisionValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">licenseValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copyrightValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">websiteValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fullPathValue</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadedCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="PluginInfoDialog"><a class="viewcode-back" href="../../api/gsdview.pluginmanager.html#gsdview.pluginmanager.PluginInfoDialog">[docs]</a><span class="k">class</span> <span class="nc">PluginInfoDialog</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">flags</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PluginInfoDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">bbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">()</span>
        <span class="n">bbox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">bbox</span><span class="o">.</span><span class="n">Close</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">PluginInfoForm</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">active</span><span class="p">))</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
    
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
    
    
    <p>
        <a href="http://sourceforge.net/projects/gsdview">
            <img src="http://sflogo.sourceforge.net/sflogo.php?group_id=226458&type=14" width="150" height="40" alt="Get GSDView at SourceForge.net. Fast, secure and Free Open Source software downloads" />
        </a>
    </p>
    

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li><a href="../../index.html">GSDView</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../gsdview.html" >gsdview</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2011, Antonio Valentino.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>